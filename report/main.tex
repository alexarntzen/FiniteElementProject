\documentclass[5p,a4paper,english]{elsarticle}% 5p gir 2 kolonner pr side. 1p gir 1 kolonne pr side.
%\documentclass[11pt,a4paper,norsk]{article} % setter hvilken type dokument. Kan også være book eller report. I klammeparantes settes fontstørrelse, papirstørrelse og språk.

\usepackage[utf8]{inputenc} %- Løser problem med å skrive andre enn engelske bokstaver f.eks æ,ø,å.

\usepackage[T1]{fontenc} %- Støtter koding av forskjellige fonter.

\usepackage{textcomp} % Støtter bruk av forskjellige fonter som dollartegn, copyright, en kvart, en halv mm, se http://gcp.fcaglp.unlp.edu.ar/_media/integrantes:psantamaria:latex:textcomp.pdf

\usepackage{url} % Gjør internett- og e-mail adresser klikkbare i tex-dokumentet.

\usepackage{hyperref} % Gjør referansene i tex-dokumentet klikkbare, slik at du kommer til referansen i referanselista.

\usepackage[english]{babel} % Ordbok. Hvis man setter norsk i options til usepackage babel kan man bruke norske ord.

\usepackage{natbib}
\bibliographystyle{unsrtnat}

\urlstyle{sf} % Velger hvilken stil url-adresser skrives, f.eks sf

\usepackage{graphicx, subfig} % Brukes for å sette inn bilder eller figurer
\usepackage{amsmath} 				% Ekstra matematikkfunksjoner.
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{mathrsfs}
\usepackage{mathtools}
\usepackage{geometry}
\usepackage{tikz-cd}
\usepackage{bm}
\usepackage{graphicx}
\usepackage{changepage}

\usepackage{siunitx}					% Må inkluderes for blant annet å få tilgang til kommandoen \SI (korrekte måltall med enheter)
	\sisetup{exponent-product = \cdot}      	% Prikk som multiplikasjonstegn (i steden for kryss).
 	\sisetup{output-decimal-marker  =  {,}} 	% Komma som desimalskilletegn (i steden for punktum).
 	\sisetup{separate-uncertainty = true}   	% Pluss-minus-form på usikkerhet (i steden for parentes). 

\usepackage{booktabs}                     		% For å få tilgang til finere linjer (til bruk i tabeller og slikt).

\usepackage[font=small,labelfont=bf]{caption}		% For justering av figurtekst og tabelltekst.


\journal{ }
\usepackage{etoolbox}
\makeatletter
\patchcmd{\ps@pprintTitle}
  {Preprint submitted to}
  {}
  {}{}
\makeatother
% Fjerner submitte dto 

% math stuff
\newcommand{\restr}[2]{\ensuremath{\left.#1\right|_{#2}}}
\newcommand{\norm}[1]{\left\lVert#1\right\rVert}

% Denne setter navnet på abstract til Sammendrag
\renewenvironment{abstract}{\global\setbox\absbox=\vbox\bgroup
\hsize=\textwidth\def\baselinestretch{1}%
\noindent\unskip\textbf{Sammendrag}
\par\medskip\noindent\unskip\ignorespaces}
{\egroup}

%\clearpage % Bruk denne kommandoen dersom du vil ha ny side etter det er satt plass til figuren.
% Disse kommandoene kan gjøre det enklere for LaTeX å plassere figurer og tabeller der du ønsker.
\setcounter{totalnumber}{5}
\renewcommand{\textfraction}{0.05}
\renewcommand{\topfraction}{0.95}
\renewcommand{\bottomfraction}{0.95}
\renewcommand{\floatpagefraction}{0.35}


% math stuff
\newtheorem{theorem}{Theorem}
\newtheorem{claim}[theorem]{Claim}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem*{observation}{Observation}
\newtheorem*{example}{Example}
\newtheorem*{remark}{Remark}

\graphicspath{{../}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

\begin{frontmatter}

\title{Element method project 1}
\author[matematikk]{Håkon Noren}

\author[matematikk]{Alexander Johan Arntzen }

\address[matematikk]{Department of Mathematical Science, Norwegian University of Science and Technology, N-7491 Trondheim, Norway.}


\begin{abstract}
Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
\end{abstract}

\end{frontmatter}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Innledning}
Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Theory}

\subsection{Problem}

We consider the poisson problem with mixed homogenous Dirichlet and Neumann boundary conditions. 

\begin{equation}
\begin{aligned}
    \nabla^2 u &= - f \\
    \restr{u}{\partial \Omega_{D}}  &= 0 \\
    \restr{\frac{\partial u}{\partial n}}{\partial \Omega_{N}} &= g,
\label{poission-problem}
\end{aligned}
\end{equation}

on the domain $\Omega$ given by the unit disk

\begin{equation*}
    \Omega = \{(x,y) : x^2+ y^2 \leq 1 \}.
\end{equation*}
Note that when $\partial \Omega_{D} = \partial \Omega$ we have the homogenous Dirichlet boundary conditions. 



\subsection{Analytical solution}
We consider an analytical solution $u$
\begin{proposition}\label{prop-analytical-solution}
    $u: \mathbb{R}^2 \rightarrow \mathbb{R}$ such that

    \begin{equation}
    \restr{u(x,y)}{\Omega} = \sin(2\pi (x^2 + y^2)),
    \label{analytical-solution}
    \end{equation}
    is a solution to the poission problem \eqref{poission-problem} with homogenous Dirichlet boundary conditions, and  $f$ in polar coordinates given by

    \begin{equation}
    f(r,\theta) = -8\pi\cos(2\pi r^2) + 16 \pi^2r^2 \sin(2\pi r^2)
    \label{f-analytic}
    \end{equation}
\end{proposition}
\begin{proof}
By calculation

\begin{equation*}
\begin{aligned}
 u_{xx} &= 4\pi\cos(g(x,y)) - 16\pi^2x^2\sin(g(x,y))
\\
u_{yy} &= 4\pi\cos(g(x,y)) - 16\pi^2y^2\sin(g(x,y)),
\end{aligned}
\end{equation*}

where $ g(x,y) = 2\pi (x^2 + y^2)$. 
As $r^2 = x^2 + y^2$ we find by comparison
\begin{equation*}
\begin{aligned}
\nabla^2 u &= u_{xx} + u_{yy}\\
&= 8\pi \cos(2\pi r^2) - 16\pi^2r^2\sin(2\pi r^2)\\
& = -f(x,y).
\end{aligned}
\end{equation*}
The boundary conditions are then checked
\begin{equation*}
    \restr{u(x,y)}{\partial\Omega} = \sin(2\pi) = 0,
\end{equation*}
and we find that $u$ fulfills all the conditions. 
\end{proof}
Then $u$ also reveals the corresponding problem with neumann bundary conditions. 

\begin{proposition}\label{analytical-solution-neumann}

$u$ defined in \eqref{analytical-solution} satisfies \eqref{poission-problem} with $g$ given in polar coordinates as
\begin{equation}
    \restr{g(r,\theta)}{\Omega_N} =  4\pi r\cos(2\pi r^2).
    \label{g-analytic}
\end{equation}
\end{proposition}
\begin{proof}
    The surface normal $\boldsymbol n$ to the unit disk $\Omega$ is the unit vector in the radial direction. Then 
    \begin{equation*}
        \frac{\partial u}{\partial n} = \frac{\partial u}{\partial r},
    \end{equation*}
    and by calculation in polar coordinates
    \begin{equation*}
        \frac{\partial u}{\partial r} = 4 \pi r \sin(2\pi r^2) = g(r,\theta)
    \end{equation*}
\end{proof}

\subsection{Weak formulation}


\begin{proposition}
    The weak formulation of \eqref{poission-problem} with homogeneous dirichlet boundary conditions is given by: find 
    \begin{equation*}
        u \in H_0^{1}(\Omega) : a(u,v) = l(v) \ \forall v \in H_0^{1}(\Omega), 
    \end{equation*}
    where $a$ is a bilinear functional and $l$ a linear functional defined as 
    \begin{equation*}
        \begin{aligned}
            a(u,v) &= \iint\limits_{\Omega} \nabla u \cdot \nabla v \, dx \, dy
            \\
            l(v) &= \iint\limits_{\Omega} fv \, dx \, dy.
        \end{aligned}
    \end{equation*}
\end{proposition}
\begin{proof}
    Assume $u$ satisfies \eqref{poission-problem}. Then mulitplying by a test function $v$ and integration over $\Omega$ results in the folloiwng integral equation
    \begin{equation}
        \label{weak-start}
        \begin{aligned}
            \iint\limits_{\Omega} \nabla^2uv \, dx \, dy &=  -\iint\limits_{\Omega} fv \, dx \, dy.\ 
        \end{aligned}
    \end{equation}
    Applying Green's first identety and the fact that $\frac{\partial u}{\partial n} = 0$ on $\partial \Omega$ gives
    \begin{equation}
        \iint\limits_{\Omega} \nabla^2 u v \, dx \, dy 
        = \underbrace{\int_{\partial \Omega} \frac{\partial u}{\partial n} v \, d\gamma}_{=0} - \iint\limits_{\Omega} \nabla u \cdot \nabla v  \, dx \, dy,
        \label{greens-identety}
    \end{equation}
    which we can apply to get 
    \begin{equation}
        \iint\limits_{\Omega} \nabla u \cdot \nabla v \, dx \, dy = 
        \iint\limits_{\Omega} fv \, dx \, dy.
    \end{equation}
    
    Since $v$ was arbitrary the weak formulation follows. Furthermore, all $u$ and $v$ must belong to a space such that $\nabla u \cdot \nabla v \in {L^1}(\Omega)$, where derivatives are of the weak form. Then $\nabla u$ and $\nabla v$ must be in ${L^2}(\Omega)$, while $u$ and $v$ must be in ${H^1_0}(\Omega)$.
    
    Finally, linearity and bilinearity of $l$ and $a$ follows directly from linearity of the weak derivative and the integral.
\end{proof}
\begin{remark}
    When Neumann boundary conditions are considered we have to change the space of test functions to 
    \begin{equation*}
        H^1_{\partial \Omega_D } = \{v \in H^1(\Omega):\restr{v}{\partial \Omega_D }=0 \}.
    \end{equation*}
    This changes $a$ and $l$, as they now operate on a new funciton space. In addition the expression for $l$ changes to
    \begin{equation*}
        l(v) = \int_{\partial \Omega_N} \frac{\partial u}{\partial n} v \, d\gamma + \iint\limits_{\Omega} f v  \, dx \, dy.
    \end{equation*}
\end{remark}

\subsection{Galerkin projection}

We now search for solutions in the finite subspace $X_h \subset X$. 
By discretizing $\Omega$ into $M$ triangles $K_k$ defined by corner nodes $x_i$, we have basis functions corresponding to each node.
Let 

\begin{equation*}
X_h = \{ v \in X : v|_{K_k} \in \mathbb{P}_1 (K_k),1\leq k\leq M \}
\end{equation*}

and $\{\phi_i\}_{i=1}^n$ be the basis functions of $X_h$ such that

\begin{equation*}
    \begin{aligned}
X_h = \text{span} \{\phi_i\}_{i=1}^n & & \phi_j(x_i) = \delta_{ij}
    \end{aligned}
\end{equation*}

hence we aim to find $u_h \in X_h$ $\forall v \in X_h$, meaning we can write

\begin{equation*}
    \begin{aligned}
u_h = \sum_{i=1}^n u_h^i \phi_i(x,y) & & v_h = \sum_{i=1}^n v_h^i \phi_i(x,y) 
    \end{aligned}
\end{equation*}

Hence we get the weak formulation

\begin{equation}
\begin{aligned}
a(u_h,v_h) &= l(v_h) 
\\
\iint\limits_{\Omega} 
\sum_{i=1}^n u_h^i \nabla \phi_i \sum_{i=1}^n v_h^i \nabla\phi_i \, dx \, dy 
&= \iint\limits_{\Omega} f \sum_{i=1}^n v_h^i \phi_i \, dx \, dy
\\
\sum_{i=1}^n\sum_{j=1}^n u_h^i v_h^i a(\phi_i,\phi_j) &= \sum_{i=1}^n v_h^i l(\phi_i)
\\
\bm v^T\bm A \bm u &= \bm v^T \bm f \quad \forall \bm v \in \mathbb R^n
\\ \bm A \bm u &= \bm f
\label{weak_formulation_matrix}
\end{aligned}
\end{equation}


\noindent where we use the linearity of $a,l$. 
The aim is now to find $u_h$ satisfying equation \eqref{weak_formulation_matrix}, $\forall \bm v \in \mathbb R^n$.
With $\bm A, \bm u, \bm f$ given by

\begin{equation}
    \begin{aligned}
\bm A &= [a(\phi_i,\phi_j)]_{i,j}
\\ 
\bm u &= [u_h^i]_i
\\
\bm f &= [l(\phi_i)]_i & i,j = 1,\cdots,n
\end{aligned}
\end{equation}

\begin{remark}
Note that in equation \eqref{weak_formulation_matrix} $\bm A$ is singular. 
This is a consequence of the fact that no boundary conditions has yet been enforced on the systems of equations.
The poisson problem stated in \eqref{poission-problem} will have infinitely many solutions $u$ when boundary conditions are not considered.
The same is then true for the solution of the discretized problem $\bm u$ and hence it follows that $\bm A$ is singular.
This is verified numerically by finding that $\text{rank}(\bm A) < n, \bm A \in \mathbb{R}^{n \times n}$.
\end{remark}


\subsection{Numerical integration}
To evaluate the integrals in the weak formulation gaussian quadrature is used. This involves calculating weights $\rho_q$ for predetermined quadrature points $z_q$ on a suitable domain, then scaling the integral
\begin{equation}
    \int_{\hat{\Omega}} g \, d\hat{\Omega} = \sum_{q=1}^{N_q}{\rho_q g(z_q)}.
\end{equation}



\subsection{Boundary conditions}
As stated in \eqref{poission-problem} we have homogenous Dirichlet conditions; $u(x,y) = 0, \forall (x,y) \in \partial \Omega$.
This has not been considered in the given construction of $\bm A,\bm f$, which could be denoted as a proto problem.
Hence, to find the solution $u \in X_h$ we will use the so called Big Number approach to enforce the boundary conditions.

For nodes on the boundary $(x_i,y_i), i=n,\cdots\tilde n$ we set

\begin{equation*}
    \begin{aligned}
    A_{ii} &= \frac{1}{\epsilon}, \, \epsilon << 1 \\
    F_i &= 0
    \end{aligned}
\end{equation*}

which for a sufficiently small $\epsilon$ enforces the boundary conditions.


\section{Numerical experiments}
\subsection{Meshing}
\begin{figure}[ht]
    \centering
        \includegraphics[width=0.5\textwidth]{figures/plot_meshes.pdf}
    \caption{The generated mesh for  16, 64 and 256 nodes. }
    \label{plot-mehses}
\end{figure}

\subsection{Homogeneous Dirichlet boundary conditions}
The finite element method described is tested on the Poisson problem with homogeneous Dirichlet conditions and $f$ given by Equation \eqref{f-analytic}. By Proposition \ref{prop-analytical-solution} the solution is known and is used as a reference. Numerical experiments with increasing degrees of freedom results in lower relative maximal error, as seen in figure \ref{convergence}. The numerical solution for $N = 1024$ nodes is plotted in figure \ref{solution-error}
together with a plot of how the error $e_{i,j} = U_{i,j} - u(x_i,y_j)$ is located on our domain $\Omega$. 

\begin{figure}[ht]
    \centering
        \includegraphics[scale=0.5]{figures/plot_homogeneous_dirichlet.pdf}
    \caption{The poission problem with homogeneous Dirichlet conditions solved on a disc mesh with $N = 1024$ nodes.
    The top plot displays the numerical solution from the Galerkin projection,
    while the bottom Figure displays the error in the nodal points.}
    \label{solution-error}
\end{figure}

\begin{figure}[tbp]
    \centering
        \includegraphics[scale=0.5]{figures/convergence_homogeneous_dirichlet.pdf}
    \caption{Relative error when solving for multiple mesh discs with the number of nodes given by $N_n = \{ 2^n\}_{n=4}^{12}$
    where $N_{min} = 16$ and $N_{max} = 4096$.}
    \label{convergence}
\end{figure}
\subsection{Mixed boundary conditions}
The finite element method is used to solve the Poisson problem given by \eqref{poission-problem} with $f$ given by Equation \eqref{f-analytic}, $g$ given by Equation \eqref{g-analytic} and $\partial \Omega_N = \{ x,y \in \partial \Omega : y> 0\}$. By Proposition \ref{analytical-solution-neumann} the solution is the is the same as for Homogeneous Dirichlet boundary conditions. Numerical experiments with increasing degrees of freedom results in lower relative maximal error, as seen in Figure \ref{convergence}. The numerical solution for $N = 1024$ nodes is plotted in Figure \ref{solution-error}
together with a plot of how the error $e_{i,j} = U_{i,j} - u(x_i,y_j)$ is located on our domain $\Omega$. 

\begin{figure}[ht]
    \centering
        \includegraphics[scale=0.7]{figures/plot_mixed_neumann.pdf}
    \caption{The poission problem with mixed boundary conditions solved on a disc mesh with $N = 1024$ nodes.
    The top plot displays the numerical solution from the Galerkin projection,
    while the bottom figure displays the error in the nodal points.}
    \label{solution-error-neumann}
\end{figure}

\begin{figure}[tbp]
    \centering
        \includegraphics[scale=0.5]{figures/convergence_mixed_neumann.pdf}
    \caption{Relative error of numerical solutios to the poission problem with mixed boundary conditions for multiple mesh discs. The number of nodes given by $N_n = \{ 2^n\}_{n=4}^{12}$
    where $N_{min} = 16$ and $N_{max} = 4096$.}
    \label{convergence-neumann}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Conclusion}
The finite difference method described compaires well with the analytic solution form Equation \eqref{analytical-solution}. For 1024 nodes, the maximal relative error is approximatley 2 \% for homogeneous Dirichlet boundary conditions, and approximatley 3 \% for mixed boundary conditions. In addition, the error decreases with as the number of nodes increases. This indicates that the method is convergent.
	

\bibliography{ref}

\end{document}


